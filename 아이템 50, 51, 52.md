# 아이템 50 오버로딩 타입보다는 조건부 타입을 사용하기

### 선요약

- 오버로딩 타입보다는 조건부 타입을 사용하는 것이 좋다.
- 조건부 타입은 추가적인 오버로딩 없이 유니온 타입을 지원할 수 있다.

### 유니온 타입

```tsx
function double(x : number|string) : number | string;
function double(x : any) {return x +x;}
```

- 선언이 틀리지 않았음
- 하지만, double에 number타입을 매개변수로 넣고 string타입을 반환하는 경우도 포함되어 있음

### 해결방안 1

- 제너릭 타입 이용

```tsx
function double<T extends number|string>(x: T) : T;
function double(x: any) {return x + x;}
```

- 타입은 구체적으로 변했으나 너무 과하게 구체적임
  - x를 매개변수로 넘길 때 동일한 x타입만 반환되어야 하는 것은 아니기 때문

### 해결방안 2

- 여러가지 타입 선언으로 분리하는 방법

```tsx
function double (x: number) : number;
function double (x : string) : string;
function double(x: any) {return x + x;}
```

- 타입은 명확해졌으나 버그는 남아있음
  - 유니온 타입 관련해서 문제가 발생함

### 조건부 타입 사용

- 모든 예제를 커버할 수 있는 경우 : 조건부 타입

```tsx
function double <T extends number | string>(
	x: T
) : T extends string ? string : number;
function double (x: any) {return x + x;}
```

- 반환 타입이 더 정교해졌음
- T가 string의 부분집합이면 반환 타입이 string
- 아니면 number를 리턴해줌
- 조건부 타입은 개별 타입의 유니온으로 일반화하기 때문에 타입이 더 정확해짐



# 아이템 51 의존성 분리를 위해 미러 타입 사용하기

### 선요약

- 필수가 아닌 의존성을 분리할 때는 구조적 타이핑을 사용하면 된다.
- 공개한 라이브러리를 사용하는 자바스크립트 사용자가 @types 의존성을 가지지 않게 해야 한다.
  - 웹 개발자가 NodeJS 관련된 의존성을 가지지 않게 해야한다.

### 의존성을 가지지 않게 해야 함

- 작성중인 라이브러리가 의존하는 라이브러리의 구현과 무관하게 타입에만 의존한다면, 필요한 선언부만 추출하여 작성중인 라이브러리에 넣는 것을 미러링이라고 한다.
- 해당 라이브러리를 사용하는 사용자가 자바스크립트 사용자일수도 있기 때문에 함께 고려가 필요함
- 다른 라이브러리 타입이 아닌 구현에 의존하는 경우에도 동일한 기법을 적용할 수 있고 타입 의존성을 피할 수 있다.
- 미러링 기법은 유닛 테스트와 상용 시스템 간의 의존성을 분리하는데 유용하다.



# 아이템 52 테스팅 타입의 함정에 주의하기

### 선요약

- 타입을 테스트할 때는 특히 함수 타입의 동일성과 할당 가능성의 차이점을 알고 있어야 한다.
- 콜백이 있는 함수를 테스트 할 때, 콜백 매개변수의 추론된 타입을 체크해야 한다.
- 타입 관련된 테스트에서 any를 주의하자.

### 1. 테스트 코드는 lint 등을 사용해 체크하는 것이 좋다.

- 프로젝트를 공개하려면 테스트 코드를 작성하는 것이 필수적이다.
- 그러나 타입선언을 테스트하는 것은 매우 어렵다.
- 단언문으로 타입 선언을 테스트하는 경우가 많지만, 궁극적인 문제를 해결하지 못할 수 있다.
  - dtslint나 타입 외부시스템에서 유사한 도구를 찾는 것이 안전하다.
- 함수를 실행만 하는 방식이 의미가 없는 것은 아니지만, 실제 반환 타입을 체크하는 것이 훨씬 좋은 테스트 코드다.

### 2. any를 주의해라

- any를 할당한 모듈은 테스트는 전부 통과하겠지만 모든 타입 안전성을 포기하게 되는 것이다.
- 또, 해당 모듈에 속하는 모든 함수의 호출마다 암시적으로 any 타입을 반환하기 때문에 코드 전반에 걸쳐 타입 안전성을 지속적으로 무너뜨리게 된다.
- 이 때에는 DefinitelyTyped의 타입 선언을 위한 도구, dtslint를 사용해라
  - 할당가능성을 체크하는 대신 각 심벌의 타입을 추출해 글자자체가 같은지 비교한다.
  - 편집기에서 타입 선언을 눈으로 보고하는 것과 같은데, 이 과정을 자동화 해준다.